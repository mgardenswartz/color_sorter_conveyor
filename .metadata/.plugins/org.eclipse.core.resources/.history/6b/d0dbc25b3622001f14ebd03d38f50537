/**
 * @file PololuServo.cpp
 * @brief Driver for a FEETECH FS90-FB Servo
 * @author Max Gardenswartz
 * @date Jun 3, 2024
 */

#include "PololuServo.h"

PololuServo::PololuServo(TIM_HandleTypeDef* timer_handle,
						uint32_t timer_channel,
						uint16_t PWM_period_us,
						uint32_t CPU_clock_speed_MHz,
						uint16_t full_left_pulse_width_us,
						uint16_t neutral_pulse_width_us,
						uint16_t full_right_pulse_width_us)
						: timer_handle(timer_handle),
						  timer_channel(timer_channel),
						  PWM_period_us(PWM_period_us),
						  CPU_clock_speed_MHz(CPU_clock_speed_MHz),
						  full_left_pulse_width_us(full_left_pulse_width_us),
						  neutral_pulse_width_us(neutral_pulse_width_us),
						  full_right_pulse_width_us(full_right_pulse_width_us)
{
	uint16_t autoreload_value = 50000;
	timer_handle->Instance->ARR = autoreload_value;
	timer_handle->Instance->PSC = (CPU_clock_speed_MHz * PWM_period_us)/autoreload_value;
	HAL_TIM_PWM_Start(timer_handle, timer_channel);
}

void PololuServo::set_position(uint16_t position_deg) // should be uint8_t
{
	__HAL_TIM_SET_COMPARE(timer_handle, timer_channel, 25000);
}

PololuServo::~PololuServo() {
	// TODO Auto-generated destructor stub
}

